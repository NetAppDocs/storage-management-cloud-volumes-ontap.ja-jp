---
sidebar: sidebar 
permalink: task-updating-ontap-cloud.html 
keywords: update, updating, upgrading, upgrade, software, downgrade, downgrading, FTP, HTTP, mediator, local image, revert, reverting, downgrading, cloud backup 
summary: NetApp ConsoleからCloud Volumes ONTAP をアップグレードして、最新の新機能と拡張機能にアクセスします。ソフトウェアをアップグレードする前に、 Cloud Volumes ONTAPシステムを準備する必要があります。 
---
= Cloud Volumes ONTAPソフトウェアのアップグレード
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
NetApp ConsoleからCloud Volumes ONTAP をアップグレードして、最新の新機能と拡張機能にアクセスします。ソフトウェアをアップグレードする前に、 Cloud Volumes ONTAPシステムを準備する必要があります。



== アップグレードの概要

Cloud Volumes ONTAP のアップグレード プロセスを開始する前に、次の点に注意してください。



=== コンソールからのみアップグレード

Cloud Volumes ONTAP は、 ONTAP System Manager またはONTAP CLI ではなく、コンソールのみを使用してアップグレードする必要があります。そうしないと、システムの安定性に影響する可能性があります。



=== アップグレード方法

コンソールでは、Cloud Volumes ONTAPをアップグレードする方法が 2 つあります。

* システムに表示されるアップグレード通知に従うことで
* アップグレードイメージをHTTPSの場所に配置し、コンソールにURLを提供することで




=== サポートされているアップグレード パス

アップグレードできるCloud Volumes ONTAPのバージョンは、現在実行しているCloud Volumes ONTAPのバージョンによって異なります。

ifdef::aws[]

[cols="2*"]
|===
| 現在のバージョン | 直接アップグレードできるバージョン 


| 9.16.1 | 9.17.1 P1 


| 9.15.1 | 9.16.1 


| 9.15.0 | 9.15.1 


.2+| 9.14.1 | 9.15.1 


| 9.15.0 


| 9.14.0 | 9.14.1 


.2+| 9.13.1 | 9.14.1 


| 9.14.0 


| 9.13.0 | 9.13.1 


.2+| 9.12.1 | 9.13.1 


| 9.13.0 


| 9.12.0 | 9.12.1 


.2+| 9.11.1 | 9.12.1 


| 9.12.0 


| 9.11.0 | 9.11.1 


.2+| 9.10.1 | 9.11.1 


| 9.11.0 


| 9.10.0 | 9.10.1 


.2+| 9.9.1 | 9.10.1 


| 9.10.0 


| 9.9.0 | 9.9.1 


| 9.8 | 9.9.1 


| 9.7 | 9.8 


| 9.6 | 9.7 


| 9.5 | 9.6 


| 9.4 | 9.5 


| 9.3 | 9.4 


| 9.2 | 9.3 


| 9.1 | 9.2 


| 9.0 | 9.1 


| 8.3 | 9.0 
|===
endif::aws[]

ifdef::azure[]

[cols="2*"]
|===
| 現在のバージョン | 直接アップグレードできるバージョン 


| 9.16.1 P3 | 9.17.1 RC1 


| 9.15.1 P10 | 9.16.1 P3 


| 9.14.1 P13 | 9.15.1 P10 


| 9.13.1 P16 | 9.14.1 P13 


| 9.12.1 P18 | 9.13.1 P16 


| 9.11.1 P20 | 9.12.1 P18 
|===
Azure にCloud Volumes ONTAPの下位バージョンがある場合は、まず次のバージョンにアップグレードし、サポートされているアップグレード パスに従ってターゲット バージョンに到達する必要があります。たとえば、 Cloud Volumes ONTAP 9.7 P7 をお持ちの場合は、次のアップグレード パスに従います。

* 9.7 P7 -> 9.8 P18
* 9.8 P18 -> 9.9.1 P15
* 9.9.1 P15 -> 9.10.1 P12
* 9.10.1 P12 -> 9.11.1 P20


endif::azure[]

ifdef::gcp[]

[cols="2*"]
|===
| 現在のバージョン | 直接アップグレードできるバージョン 


| 9.16.1 (Azure および Google Cloud のみ) | 9.17.1 (Azure および Google Cloud のみ) 


| 9.15.1 | 9.16.1 (Azure および Google Cloud のみ) 


| 9.15.0 | 9.15.1 


.2+| 9.14.1 | 9.15.1 


| 9.15.0 


| 9.14.0 | 9.14.1 


.2+| 9.13.1 | 9.14.1 


| 9.14.0 


| 9.13.0 | 9.13.1 


.2+| 9.12.1 | 9.13.1 


| 9.13.0 


| 9.12.0 | 9.12.1 


.2+| 9.11.1 | 9.12.1 


| 9.12.0 


| 9.11.0 | 9.11.1 


.2+| 9.10.1 | 9.11.1 


| 9.11.0 


| 9.10.0 | 9.10.1 


.2+| 9.9.1 | 9.10.1 


| 9.10.0 


| 9.9.0 | 9.9.1 


| 9.8 | 9.9.1 


| 9.7 | 9.8 


| 9.6 | 9.7 


| 9.5 | 9.6 


| 9.4 | 9.5 


| 9.3 | 9.4 


| 9.2 | 9.3 


| 9.1 | 9.2 


| 9.0 | 9.1 


| 8.3 | 9.0 
|===
endif::gcp[]

次の点に注意してください。

* Cloud Volumes ONTAPでサポートされているアップグレード パスは、オンプレミスのONTAPクラスターの場合とは異なります。
* システムに表示される通知に従ってアップグレードする場合、コンソールは、サポートされているアップグレード パスに従うリリースにアップグレードするように要求します。
* アップグレード イメージを HTTPS の場所に配置してアップグレードする場合は、サポートされているアップグレード パスに必ず従ってください。
* 場合によっては、目標リリースに到達するまでに数回のアップグレードが必要になることがあります。
+
たとえば、バージョン 9.8 を実行していて、9.10.1 にアップグレードする場合は、最初にバージョン 9.9.1 にアップグレードし、次に 9.10.1 にアップグレードする必要があります。





=== パッチリリース

2024 年 1 月以降、パッチ アップグレードは、Cloud Volumes ONTAPの最新の 3 つのバージョンのパッチ リリースがある場合にのみ利用できます。  RC バージョンまたは GA バージョンが展開に使用できない場合、パッチ バージョンが展開に使用できるようになることがあります。

最新の GA リリースを使用して、コンソールに表示する最新の 3 つのバージョンを決定します。たとえば、現在の GA リリースが 9.13.1 の場合、コンソールには 9.11.1 ～ 9.13.1 のパッチが表示されます。

パッチバージョン9.11.1以下の場合は、以下の手順で手動アップグレードを行う必要があります。<<URL で入手可能なイメージからアップグレードする,ONTAPイメージのダウンロード>> 。

パッチ リリースの一般的なルールとして、同じまたは次のCloud Volumes ONTAPリリースで、低いパッチ バージョンから高いパッチ バージョンにアップグレードできます。

以下にいくつかの例を挙げます。

* 9.13.0 -> 9.13.1 P15
* 9.12.1 -> 9.13.1 P2




=== 元に戻すまたはダウングレードする

Cloud Volumes ONTAP を以前のリリースに戻したりダウングレードしたりすることはサポートされていません。



=== サポート登録

このページに記載されているいずれかの方法を使用してソフトウェアをアップグレードするには、 Cloud Volumes ONTAP をNetAppサポートに登録する必要があります。これは、従量課金制 (PAYGO) とライセンス持ち込み (BYOL) の両方に適用されます。必要となるのはlink:task-registering.html["PAYGOシステムを手動で登録する"]BYOL システムはデフォルトで登録されます。


TIP: サポートに登録されていないシステムでも、新しいバージョンが利用可能になったときにコンソールに表示されるソフトウェア更新通知を受信します。ただし、ソフトウェアをアップグレードする前にシステムを登録する必要があります。



=== HAメディエーターのアップグレード

コンソールは、Cloud Volumes ONTAP のアップグレード プロセス中に必要に応じてメディエーター インスタンスも更新します。



=== AWS の c4、m4、r4 EC2 インスタンスタイプのアップグレード

Cloud Volumes ONTAP は、 c4、m4、および r4 EC2 インスタンス タイプをサポートしなくなりました。これらのインスタンス タイプを使用して、既存のデプロイメントをCloud Volumes ONTAPバージョン 9.8 ～ 9.12.1 にアップグレードできます。アップグレードする前に、<<インスタンスタイプを変更する,インスタンスタイプを変更する>> 。インスタンスタイプを変更できない場合は、<<拡張ネットワークを有効にする,拡張ネットワークを有効にする>>アップグレードする前に。インスタンス タイプの変更と拡張ネットワークの有効化の詳細については、次のセクションをお読みください。

バージョン 9.13.0 以降を実行しているCloud Volumes ONTAPでは、c4、m4、および r4 EC2 インスタンス タイプを使用してアップグレードすることはできません。この場合は、ディスクの数を減らしてから<<インスタンスタイプを変更する,インスタンスタイプを変更する>>または、c5、m5、r5 EC2 インスタンス タイプを使用して新しい HA ペア構成を展開し、データを移行します。



==== インスタンスタイプを変更する

c4、m4、r4 EC2 インスタンス タイプでは、c5、m5、r5 EC2 インスタンス タイプよりもノードあたりのディスク数が多くなります。実行中の c4、m4、または r4 EC2 インスタンスのノードあたりのディスク数が、c5、m5、および r5 インスタンスのノードあたりの最大ディスク許容量を下回っている場合は、EC2 インスタンスタイプを c5、m5、または r5 に変更できます。

link:https://docs.netapp.com/us-en/cloud-volumes-ontap-relnotes/reference-limits-aws.html#disk-and-tiering-limits-by-ec2-instance["EC2インスタンスごとにディスクと階層化の制限を確認する"^] link:https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-change-ec2-instance.html["Cloud Volumes ONTAPのEC2インスタンスタイプを変更する"^]

インスタンスタイプを変更できない場合は、<<拡張ネットワークを有効にする>> 。



==== 拡張ネットワークを有効にする

Cloud Volumes ONTAPバージョン 9.8 以降にアップグレードするには、c4、m4、または r4 インスタンス タイプを実行しているクラスターで拡張ネットワークを有効にする必要があります。  ENAを有効にするには、ナレッジベースの記事を参照してください。link:https://kb.netapp.com/Cloud/Cloud_Volumes_ONTAP/How_to_enable_Enhanced_networking_like_SR-IOV_or_ENA_on_AWS_CVO_instances["AWS Cloud Volumes ONTAPインスタンスでSR-IOVやENAなどの拡張ネットワークを有効にする方法"^] 。



== アップグレードの準備

アップグレードを実行する前に、システムの準備ができていることを確認し、必要な構成の変更を行う必要があります。

* <<ダウンタイムを計画する>>
* <<自動ギブバックがまだ有効になっていることを確認します>>
* <<SnapMirror転送を一時停止する>>
* <<集計がオンラインであることを確認する>>
* <<すべてのLIFがホームポートにあることを確認する>>




=== ダウンタイムを計画する

単一ノード システムをアップグレードする場合、アップグレード プロセスによりシステムが最大 25 分間オフラインになり、その間に I/O が中断されます。

多くの場合、HA ペアのアップグレードは中断を伴わず、I/O も中断されません。この中断のないアップグレード プロセスでは、各ノードが同時にアップグレードされ、クライアントへの I/O の提供が継続されます。

セッション指向プロトコルは、アップグレード中に特定の領域のクライアントとアプリケーションに悪影響を及ぼす可能性があります。詳細については、 https://docs.netapp.com/us-en/ontap/upgrade/concept_considerations_for_session_oriented_protocols.html["ONTAPのドキュメント"^]



=== 自動ギブバックがまだ有効になっていることを確認します

Cloud Volumes ONTAP HA ペアでは自動ギブバックを有効にする必要があります (これがデフォルト設定です)。そうでない場合、操作は失敗します。

http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-hacg/GUID-3F50DE15-0D01-49A5-BEFD-D529713EC1FA.html["ONTAPドキュメント: 自動ギブバックを設定するためのコマンド"^]



=== SnapMirror転送を一時停止する

Cloud Volumes ONTAPシステムにアクティブなSnapMirror関係がある場合は、 Cloud Volumes ONTAPソフトウェアを更新する前に転送を一時停止することをお勧めします。転送を一時停止すると、 SnapMirror の障害を防ぐことができます。宛先システムからの転送を一時停止する必要があります。


NOTE: NetApp Backup and Recovery はSnapMirrorの実装を使用してバックアップ ファイル ( SnapMirror Cloud と呼ばれる) を作成しますが、システムのアップグレード時にバックアップを中断する必要はありません。

.タスク概要
これらの手順では、バージョン 9.3 以降のONTAP System Manager を使用する方法について説明します。

.手順
. 宛先システムから System Manager にログインします。
+
Web ブラウザでクラスタ管理 LIF の IP アドレスを指定すると、System Manager にログインできます。  IP アドレスはCloud Volumes ONTAPシステムで確認できます。

+

NOTE: コンソールにアクセスするコンピューターは、Cloud Volumes ONTAPへのネットワーク接続が必要です。たとえば、クラウド プロバイダー ネットワーク内のジャンプ ホストからコンソールにログインする必要がある場合があります。

. *保護 > 関係*をクリックします。
. 関係を選択し、*操作 > 静止*をクリックします。




=== 集計がオンラインであることを確認する

ソフトウェアを更新する前に、 Cloud Volumes ONTAPのアグリゲートがオンラインになっている必要があります。ほとんどの構成ではアグリゲートはオンラインになるはずですが、そうでない場合はオンラインにする必要があります。

.タスク概要
これらの手順では、バージョン 9.3 以降のONTAP System Manager を使用する方法について説明します。

.手順
. Cloud Volumes ONTAPシステムで、[*Aggregates*] タブをクリックします。
. 必要な集計タイルで、image:icon-action.png[""]アイコンをクリックし、[集計の詳細を表示] を選択します。
+
image:screenshots_aggregate_details_state.png["スクリーン ショット: 集計の情報を表示するときに、状態フィールドが表示されます。"]

. アグリゲートがオフラインの場合は、 ONTAP System Manager を使用してアグリゲートをオンラインにします。
+
.. *ストレージ > アグリゲートとディスク > アグリゲート*をクリックします。
.. 集約を選択し、*その他のアクション > ステータス > オンライン*をクリックします。






=== すべてのLIFがホームポートにあることを確認する

アップグレードする前に、すべての LIF がホーム ポート上にある必要があります。  ONTAPのドキュメントを参照してください。link:https://docs.netapp.com/us-en/ontap/upgrade/task_enabling_and_reverting_lifs_to_home_ports_preparing_the_ontap_software_for_the_update.html["すべてのLIFがホームポートにあることを確認する"^] 。

アップグレード失敗エラーが発生した場合は、ナレッジベース（KB）の記事を参照してください。link:https://kb.netapp.com/Cloud/Cloud_Volumes_ONTAP/CVO_upgrade_fails["Cloud Volumes ONTAPのアップグレードが失敗する"^] 。



== Cloud Volumes ONTAP のアップグレード

新しいバージョンがアップグレード可能になると、コンソールから通知されます。この通知からアップグレード プロセスを開始できます。詳細については、以下を参照してください。 <<コンソールからのアップグレード通知>> 。

外部 URL 上のイメージを使用してソフトウェア アップグレードを実行する別の方法。このオプションは、コンソールがソフトウェアをアップグレードするために S3 バケットにアクセスできない場合、またはパッチが提供された場合に役立ちます。詳細については、以下を参照してください。 <<URL で入手可能なイメージからアップグレードする>> 。



=== コンソールからのアップグレード通知

Cloud Volumes Cloud Volumes ONTAPの新しいバージョンが利用可能になると、コンソールにCloud Volumes ONTAP の作業環境に通知が表示されます。


NOTE: 通知を通じてCloud Volumes ONTAPをアップグレードする前に、 NetAppサポート サイト アカウントが必要です。

この通知からアップグレード プロセスを開始できます。このプロセスでは、S3 バケットからソフトウェア イメージを取得し、イメージをインストールして、システムを再起動することでプロセスが自動化されます。

.開始する前に
Cloud Volumes ONTAPシステムでは、ボリュームやアグリゲートの作成などの操作が進行中であってはなりません。

.手順
. 左側のナビゲーション メニューから、*ストレージ > 管理* を選択します。
. Cloud Volumes ONTAPシステムを選択します。
+
新しいバージョンが利用可能な場合は、[概要] タブに通知が表示されます。

+
image:screenshot_overview_upgrade.png["「概要」タブの下にある「今すぐアップグレード！」リンクが表示されているスクリーンショット。"]

. インストールされているCloud Volumes ONTAPのバージョンをアップグレードする場合は、[今すぐアップグレード] をクリックします。デフォルトでは、アップグレード用に最新の互換性のあるバージョンが表示されます。
+
image:screenshot_upgrade_select_versions.png["Cloud Volumes ONTAPバージョンのアップグレード ページのスクリーンショット。"]

+
別のバージョンにアップグレードする場合は、「*他のバージョンを選択*」をクリックします。システムにインストールされているバージョンと互換性のある最新のCloud Volumes ONTAPバージョンがリストされます。たとえば、システムにインストールされているバージョンが 9.12.1P3 で、次の互換性のあるバージョンが利用可能です。

+
** 9.12.1P4～9.12.1P14
** 9.13.1 および 9.13.1P1 アップグレードのデフォルト バージョンとして 9.13.1P1 が表示され、その他の使用可能なバージョンとして 9.12.1P13、9.13.1P14、9.13.1、および 9.13.1P1 が表示されます。


. オプションで、[*すべてのバージョン*] をクリックして、アップグレードする別のバージョン (インストールされているバージョンの次のパッチなど) を入力することもできます。現在のCloud Volumes ONTAPバージョンの互換性のあるアップグレードパスについては、以下を参照してください。link:task-updating-ontap-cloud.html#supported-upgrade-paths["サポートされているアップグレード パス"] 。
. *[保存]*をクリックし、*[適用]*をクリックします。image:screenshot_upgrade_other_versions.png["アップグレード可能なバージョンを表示するスクリーンショット。"]
. Cloud Volumes ONTAP のアップグレードページで、EULA を読み、*EULA を読んで承認します*を選択します。
. *アップグレード*を選択します。
. 進行状況を表示するには、 Cloud Volumes ONTAPシステムで *Audit* を選択します。


.結果
コンソールはソフトウェアのアップグレードを開始します。ソフトウェアの更新が完了すると、システム上でアクションを実行できます。

.終了後の操作
SnapMirror転送を一時停止した場合は、System Manager を使用して転送を再開します。



=== URL で入手可能なイメージからアップグレードする

Cloud Volumes ONTAPソフトウェア イメージをコンソール エージェントまたは HTTP サーバーに配置し、コンソールからソフトウェア アップグレードを開始できます。コンソールが S3 バケットにアクセスできず、ソフトウェアをアップグレードできない場合は、このオプションを使用できます。

.開始する前に
* Cloud Volumes ONTAPシステムでは、ボリュームやアグリゲートの作成などの操作が進行中であってはなりません。
* HTTPS を使用してONTAPイメージをホストする場合、証明書の不足によって発生する SSL 認証の問題により、アップグレードが失敗する可能性があります。回避策としては、 ONTAPとコンソール間の認証に使用する CA 署名付き証明書を生成してインストールします。
+
NetAppナレッジベースにアクセスして、手順ごとの説明を参照してください。

+
https://kb.netapp.com/Advice_and_Troubleshooting/Cloud_Services/Cloud_Manager/How_to_configure_Cloud_Manager_as_an_HTTPS_server_to_host_upgrade_images["NetApp KB: アップグレードイメージをホストする HTTPS サーバーとしてコンソールを構成する方法"^]



.手順
. オプション: Cloud Volumes ONTAPソフトウェア イメージをホストできる HTTP サーバーをセットアップします。
+
仮想ネットワークへの VPN 接続がある場合は、 Cloud Volumes ONTAPソフトウェア イメージを独自のネットワーク内の HTTP サーバーに配置できます。それ以外の場合は、クラウド内の HTTP サーバーにファイルを配置する必要があります。

. Cloud Volumes ONTAPに独自のセキュリティ グループを使用する場合は、 Cloud Volumes ONTAP がソフトウェア イメージにアクセスできるように、送信ルールで HTTP 接続が許可されていることを確認します。
+

NOTE: 事前定義されたCloud Volumes ONTAPセキュリティ グループは、デフォルトで送信 HTTP 接続を許可します。

. ソフトウェアイメージを入手する https://mysupport.netapp.com/site/products/all/details/cloud-volumes-ontap/downloads-tab["NetAppサポート サイト"^]。
. ソフトウェア イメージを、コンソール エージェント上のディレクトリまたはファイルの提供元となる HTTP サーバー上のディレクトリにコピーします。
+
2つのパスが利用可能です。正しいパスは、コンソール エージェントのバージョンによって異なります。

+
** `/opt/application/netapp/cloudmanager/docker_occm/data/ontap/images/`
** `/opt/application/netapp/cloudmanager/ontap/images/`


. システム上で、image:icon-action.png[""]アイコンをクリックし、* Cloud Volumes ONTAPの更新*をクリックします。
. Cloud Volumes ONTAPバージョンの更新ページで URL を入力し、[イメージの変更] をクリックします。
+
上記のパスにあるコンソール エージェントにソフトウェア イメージをコピーした場合は、次の URL を入力します。

+
\http://<コンソールエージェントのプライベートIPアドレス>/ontap/images/<イメージファイル名>

+

NOTE: URL では、*image-file-name* は「cot.image.9.13.1P2.tgz」という形式に従う必要があります。

. *続行*をクリックして確認します。


.結果
コンソールがソフトウェアの更新を開始します。ソフトウェアの更新が完了すると、システム上でアクションを実行できるようになります。

.終了後の操作
SnapMirror転送を一時停止した場合は、System Manager を使用して転送を再開します。

ifdef::gcp[]



== Google Cloud NAT ゲートウェイ使用時のダウンロード失敗を修正

コンソール エージェントは、 Cloud Volumes ONTAPのソフトウェア アップデートを自動的にダウンロードします。構成で Google Cloud NAT ゲートウェイを使用している場合、ダウンロードが失敗する可能性があります。ソフトウェア イメージを分割する部分の数を制限することで、この問題を修正できます。このステップを完了するには、API を使用する必要があります。

.手順
. 次の JSON を本文として PUT リクエストを `/occm/`config に送信します。


[source]
----
{
  "maxDownloadSessions": 32
}
----
_maxDownloadSessions_ の値は 1 または 1 より大きい任意の整数にすることができます。値が 1 の場合、ダウンロードされたイメージは分割されません。

32 は例の値であることに注意してください。使用する値は、NAT 構成と同時に実行できるセッションの数によって異なります。

https://docs.netapp.com/us-en/bluexp-automation/cm/api_ref_resources.html#occmconfig["/occm/config API呼び出しの詳細"^] 。

endif::gcp[]
