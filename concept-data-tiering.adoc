---
sidebar: sidebar 
permalink: concept-data-tiering.html 
keywords: storage tiering, tier, tiering, data tiering, s3, s3 tiering, capacity, performance, s3 endpoint, fabric pool, fabricpool, s3 bucket, requirement, vpc endpoint, policy, policies, tiering policies, auto, snapshot only, backup, none, cooling period, volume tiering policies, blob, standard, infrequent access, hot, cool, tiering level, storage tier, storage class 
summary: コールド データを低コストのオブジェクト ストレージに自動的に階層化できるようにすることで、ストレージ コストを削減します。 
---
= AWS、Azure、Google Cloud でのCloud Volumes ONTAPによるデータ階層化について学習します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
非アクティブなデータを低コストのオブジェクト ストレージに自動的に階層化することで、ストレージ コストを削減します。アクティブなデータは高性能の SSD または HDD に残り、非アクティブなデータは低コストのオブジェクト ストレージに階層化されます。これにより、プライマリ ストレージのスペースを再利用し、セカンダリ ストレージを縮小することができます。

image:diagram_data_tiering.png["これは、ホット データが EBS ストレージに送られ、非アクティブなデータが S3 ストレージに送られることを示す概念図です。"]

データ階層化はFabricPoolテクノロジーによって実現されます。 Cloud Volumes ONTAP は、追加のライセンスなしで、すべてのCloud Volumes ONTAPクラスターのデータ階層化を提供します。データ階層化を有効にすると、オブジェクト ストレージに階層化されたデータに対して料金が発生します。オブジェクト ストレージのコストの詳細については、クラウド プロバイダーのドキュメントを参照してください。

ifdef::aws[]



== AWS におけるデータ階層化

AWS でデータ階層化を有効にすると、 Cloud Volumes ONTAP はホットデータのパフォーマンス階層として EBS を使用し、非アクティブデータの容量階層として AWS S3 を使用します。

パフォーマンス層:: パフォーマンス層は、汎用 SSD (gp3 または gp2) またはプロビジョニングされた IOPS SSD (io1) にすることができます。
+
--
スループット最適化 HDD (st1) を使用する場合、オブジェクト ストレージへのデータの階層化は推奨されません。

--
容量層:: Cloud Volumes ONTAPシステムは、非アクティブなデータを単一の S3 バケットに階層化します。
+
--
NetApp Consoleは、システムごとに 1 つの S3 バケットを作成し、fabric-pool-_cluster unique identifier_ という名前を付けます。ボリュームごとに異なる S3 バケットは作成されません。

コンソールが S3 バケットを作成するときは、次のデフォルト設定が使用されます。

* ストレージクラス: 標準
* デフォルトの暗号化: 無効
* パブリックアクセスをブロック: すべてのパブリックアクセスをブロック
* オブジェクトの所有権: ACL が有効
* バケットのバージョン管理: 無効
* オブジェクトロック: 無効


--
ストレージクラス:: AWS の階層化データのデフォルトのストレージ クラスは _Standard_ です。  Standard は、複数のアベイラビリティーゾーンに保存され、頻繁にアクセスされるデータに最適です。
+
--
非アクティブなデータにアクセスする予定がない場合は、ストレージ クラスを次のいずれかに変更することで、ストレージ コストを削減できます: _Intelligent Tiering_、_One-Zone Infrequent Access_、_Standard-Infrequent Access_、または _S3 Glacier Instant Retrieval_。ストレージ クラスを変更すると、非アクティブなデータは標準ストレージ クラスから開始され、30 日間アクセスされない場合、選択したストレージ クラスに移行します。

データにアクセスする場合はアクセス コストが高くなるため、ストレージ クラスを変更する前にこの点を考慮してください。 https://aws.amazon.com/s3/storage-classes["Amazon S3 ドキュメント: Amazon S3 ストレージクラスの詳細"^] 。

システムを作成するときにストレージ クラスを選択でき、その後いつでも変更できます。ストレージクラスの変更手順については、link:task-tiering.html["非アクティブなデータを低コストのオブジェクトストレージに階層化"] 。

データ階層化のストレージ クラスはシステム全体にわたっており、ボリュームごとではありません。

--


endif::aws[]

ifdef::azure[]



== Azure のデータ階層化

Azure でデータ階層化を有効にすると、 Cloud Volumes ONTAP は、ホット データのパフォーマンス層として Azure マネージド ディスクを使用し、非アクティブ データの容量層として Azure Blob ストレージを使用します。

パフォーマンス層:: パフォーマンス層は SSD または HDD のいずれかになります。
容量層:: Cloud Volumes ONTAPシステムは、非アクティブなデータを単一の BLOB コンテナーに階層化します。
+
--
コンソールは、各Cloud Volumes ONTAPシステムのコンテナを含む新しいストレージ アカウントを作成します。ストレージ アカウントの名前はランダムです。ボリュームごとに異なるコンテナは作成されません。

コンソールは、次の設定でストレージ アカウントを作成します。

* アクセス層: ホット
* パフォーマンス: 標準
* 冗長性: Cloud Volume ONTAP の展開に準拠
+
** 単一の可用性ゾーン: ローカル冗長ストレージ (LRS)
** 複数の可用性ゾーン: ゾーン冗長ストレージ (ZRS)


* アカウント: StorageV2 (汎用 v2)
* REST API操作に安全な転送を要求する: 有効
* ストレージ アカウント キー アクセス: 有効
* 最小 TLS バージョン: バージョン 1.2
* インフラストラクチャ暗号化: 無効


--
ストレージアクセス層:: Azure の階層化データの既定のストレージ アクセス層は、_ホット_ 層です。ホット層は、容量層で頻繁にアクセスされるデータに最適です。
+
--
容量層の非アクティブなデータにアクセスする予定がない場合は、非アクティブなデータが最低 30 日間保持される「クール」ストレージ層を選択できます。非アクティブなデータが最低 90 日間保存される _cold_ 層を選択することもできます。ストレージ要件とコストの考慮事項に基づいて、ニーズに最適な層を選択できます。ストレージ層を _cool_ または _cold_ に変更すると、非アクティブな容量層のデータはクールまたはコールド ストレージ層に直接移動されます。クール層とコールド層はホット層に比べてストレージ コストが低くなりますが、アクセス コストが高くなるため、ストレージ層を変更する前にその点を考慮してください。参照 https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-storage-tiers["Microsoft Azure ドキュメント: Azure Blob ストレージのアクセス層の詳細"^]。

Cloud Volumes ONTAPシステムを追加するときにストレージ層を選択でき、その後いつでも変更できます。ストレージ階層の変更の詳細については、link:task-tiering.html["非アクティブなデータを低コストのオブジェクトストレージに階層化"] 。

データ階層化のストレージ アクセス層はシステム全体にわたっており、ボリュームごとではありません。

--


endif::azure[]

ifdef::gcp[]



== Google Cloud におけるデータ階層化

Google Cloud でデータ階層化を有効にすると、 Cloud Volumes ONTAP は、ホット データのパフォーマンス階層として永続ディスクを使用し、非アクティブなデータの容量階層として Google Cloud Storage バケットを使用します。

パフォーマンス層:: パフォーマンス レベルは、SSD 永続ディスク、バランス永続ディスク、標準永続ディスクのいずれかになります。
容量層:: Cloud Volumes ONTAPシステムは、非アクティブなデータを単一の Google Cloud Storage バケットに階層化します。
+
--
コンソールは各システムのバケットを作成し、fabric-pool-_cluster unique identifier_ という名前を付けます。ボリュームごとに異なるバケットは作成されません。

コンソールがバケットを作成するときは、次のデフォルト設定が使用されます。

* 場所の種類: 地域
* ストレージクラス: 標準
* パブリックアクセス: オブジェクト ACL の対象
* アクセス制御: きめ細かな
* 保護: なし
* データ暗号化: Google 管理の鍵


--
ストレージクラス:: 階層化データのデフォルトのストレージ クラスは、_Standard Storage_ クラスです。データへのアクセス頻度が低い場合は、_Nearline Storage_ または _Coldline Storage_ に変更することでストレージ コストを削減できます。ストレージ クラスを変更すると、それ以降の非アクティブなデータは選択したクラスに直接移動されます。
+
--

NOTE: ストレージ クラスを変更しても、既存の非アクティブなデータはデフォルトのストレージ クラスを維持します。既存の非アクティブ データのストレージ クラスを変更するには、指定を手動で実行する必要があります。

データにアクセスする場合はアクセス コストが高くなるため、ストレージ クラスを変更する前にその点を考慮してください。詳細については、 https://cloud.google.com/storage/docs/storage-classes["Google Cloud ドキュメント: ストレージ クラス"^] 。

システムを作成するときにストレージ層を選択でき、その後いつでも変更できます。ストレージクラスの変更の詳細については、link:task-tiering.html["非アクティブなデータを低コストのオブジェクトストレージに階層化"] 。

データ階層化のストレージ クラスはシステム全体にわたっており、ボリュームごとではありません。

--


endif::gcp[]



== データの階層化と容量制限

データ階層化を有効にすると、システムの容量制限は変わりません。制限はパフォーマンス層と容量層にまたがって適用されます。



== ボリューム階層化ポリシー

データ階層化を有効にするには、ボリュームを作成、変更、または複製するときにボリューム階層化ポリシーを選択する必要があります。ボリュームごとに異なるポリシーを選択できます。

一部の階層化ポリシーには、最小冷却期間が関連付けられており、ボリューム内のユーザー データが「コールド」であるとみなされて容量階層に移動されるまでの非アクティブ状態を維持する必要がある時間を設定します。冷却期間は、データがアグリゲートに書き込まれたときに開始されます。


TIP: 最小冷却期間とデフォルトの集計しきい値 50% を変更できます (詳細は後述)。 http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-mgng-stor-tier-fp/GUID-AD522711-01F9-4413-A254-929EAE871EBF.html["冷却期間を変更する方法を学ぶ"^]そして http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-mgng-stor-tier-fp/GUID-8FC4BFD5-F258-4AA6-9FCB-663D42D92CAA.html["しきい値を変更する方法を学ぶ"^]。

コンソールでは、ボリュームを作成または変更するときに、次のボリューム階層化ポリシーを選択できます。

Snapshot のみ:: アグリゲートの容量が 50% に達すると、 Cloud Volumes ONTAPは、アクティブ ファイル システムに関連付けられていない Snapshot コピーのユーザー データを容量層に階層化します。冷却期間は約2日間です。
+
--
読み取られると、容量層のコールド データ ブロックがホットになり、パフォーマンス層に移動されます。

--
全て:: すべてのデータ (メタデータを除く) は直ちにコールドとしてマークされ、できるだけ早くオブジェクト ストレージに階層化されます。ボリューム内の新しいブロックがコールドになるまで 48 時間待つ必要はありません。  「すべて」ポリシーが設定される前にボリューム内に配置されていたブロックがコールド状態になるには 48 時間かかることに注意してください。
+
--
読み込まれた場合、クラウド階層のコールド データ ブロックはコールドのままで、パフォーマンス階層に書き戻されません。このポリシーは、 ONTAP 9.6 以降で使用できます。

--
オート:: アグリゲートの容量が 50% に達すると、 Cloud Volumes ONTAPはボリューム内のコールド データ ブロックを容量層に階層化します。コールド データには、スナップショット コピーだけでなく、アクティブ ファイル システムからのコールド ユーザー データも含まれます。冷却期間は約31日間です。
+
--
このポリシーは、Cloud Volumes ONTAP 9.4 以降でサポートされています。

ランダム読み取りによって読み取られると、キャパシティ層のコールド データ ブロックがホットになり、パフォーマンス層に移動します。インデックスやウイルス対策スキャンなどに関連する順次読み取りによって読み取られた場合、コールド データ ブロックはコールドのままとなり、パフォーマンス層に移動されません。

--
なし:: ボリュームのデータをパフォーマンス層に保持し、容量層に移動されないようにします。


.レプリケーション
ボリュームを複製するときに、データをオブジェクト ストレージに階層化するかどうかを選択できます。そうすると、コンソールはデータ保護ボリュームに *バックアップ* ポリシーを適用します。Cloud Volumes ONTAP 9.6 以降では、バックアップ ポリシーが *All* 階層化ポリシーに置き換えられます。レプリケーション関係が削除されると、宛先ボリュームはレプリケーション中に有効だった階層化ポリシーを保持します。



=== Cloud Volumes ONTAPをオフにすると冷却期間に影響します

データ ブロックは、クーリング スキャンによって冷却されます。このプロセス中、使用されていないブロックのブロック温度は次の低い値に移動（冷却）されます。デフォルトの冷却時間はボリューム階層化ポリシーによって異なります。

* 自動: 31日間
* スナップショットのみ: 2日間


冷却スキャンが機能するには、 Cloud Volumes ONTAP が実行されている必要があります。 Cloud Volumes ONTAP をオフにすると、冷却も停止します。その結果、冷却時間が長くなる可能性があります。


TIP: Cloud Volumes ONTAP をオフにすると、システムを再起動するまで各ブロックの温度が保持されます。たとえば、システムをオフにしたときにブロックの温度が 5 だった場合、システムを再びオンにしたときも温度は 5 のままです。



== データ階層化の設定

手順とサポートされている構成のリストについては、以下を参照してください。link:task-tiering.html["非アクティブなデータを低コストのオブジェクトストレージに階層化"] 。
