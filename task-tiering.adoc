---
sidebar: sidebar 
permalink: task-tiering.html 
keywords: tier, tiering, cold data, hot data, storage tiering, data tiering, fabricpool, fabric pool, s3 endpoint, endpoint, connection, performance tier, capacity tier, object store, blob tiering, container, inactive, tiering requirements, remove S3 bucket, delete S3 CVO bucket, tenant, multi-tenant tiering 
summary: ホット データ用の SSD または HDD パフォーマンス層と非アクティブ データ用のオブジェクト ストレージ容量層を組み合わせることで、 Cloud Volumes ONTAPのストレージ コストを削減できます。データ階層化はFabricPoolテクノロジーによって実現されます。 
---
= 非アクティブなCloud Volumes ONTAPデータを低コストのオブジェクトストレージに階層化します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ホット データ用の SSD または HDD パフォーマンス層と非アクティブ データ用のオブジェクト ストレージ容量層を組み合わせることで、 Cloud Volumes ONTAPのストレージ コストを削減できます。データ階層化はFabricPoolテクノロジーによって実現されます。概要については、以下を参照してください。link:concept-data-tiering.html["データ階層化の概要"] 。

データ階層化を設定するには、次の手順を実行する必要があります。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["1"]サポートされている構成を選択してください
[role="quick-margin-para"]
ほとんどの構成がサポートされています。最新バージョンを実行しているCloud Volumes ONTAPシステムをお持ちの場合は、そのままご利用いただけます。link:task-tiering.html#configurations-that-support-data-tiering["詳細情報"] 。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["2"]Cloud Volumes ONTAPとオブジェクトストレージ間の接続を確保する
[role="quick-margin-list"]
ifdef::aws[]

* AWS の場合、S3 への VPC エンドポイントが必要になります。<<コールドデータをAWS S3に階層化するための要件,詳細情報>> 。


endif::aws[]

ifdef::azure[]

* Azure の場合、 NetAppコンソールに必要な権限がある限り、何もする必要はありません。<<コールドデータをAzure Blobストレージに階層化するための要件,詳細情報>> 。


endif::azure[]

ifdef::gcp[]

* Google Cloud の場合、プライベート Google アクセスのサブネットを構成し、サービス アカウントを設定する必要があります。<<コールドデータを Google Cloud Storage バケットに階層化するための要件,詳細情報>> 。


endif::gcp[]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["三つ"]階層化が有効になっているアグリゲートがあることを確認します
[role="quick-margin-para"]
ボリューム上でデータ階層化を有効にするには、アグリゲート上でデータ階層化を有効にする必要があります。新しいボリュームと既存のボリュームの要件を認識しておく必要があります。<<アグリゲートで階層化が有効になっていることを確認する,詳細情報>> 。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-4.png["4"]ボリュームを作成、変更、または複製するときに階層化ポリシーを選択します
[role="quick-margin-para"]
NetAppコンソールでは、ボリュームを作成、変更、または複製するときに階層化ポリシーを選択するように求められます。

[role="quick-margin-list"]
* link:task-tiering.html#tier-data-from-read-write-volumes["読み書きボリュームからの階層データ"]
* link:task-tiering.html#tier-data-from-data-protection-volumes["データ保護ボリュームからの階層データ"]


[NOTE]
.データ階層化に必須ではないものは何ですか?
====
* データ階層化を有効にするために機能ライセンスをインストールする必要はありません。
* 容量層用のオブジェクト ストアを作成する必要はありません。コンソールがそれを実行します。
* システム レベルでデータ階層化を有効にする必要はありません。
+
コンソールはシステムを作成するときにコールドデータ用のオブジェクトストアを作成します。<<要件を実装した後、データ階層化を有効にする,接続や権限の問題がない限り>> 。その後は、ボリューム上のデータ階層化を有効にするだけです（場合によっては、<<アグリゲートで階層化が有効になっていることを確認する,骨材について>> ）。



====


== データ階層化をサポートする構成

特定の構成と機能を使用する場合、データ階層化を有効にすることができます。

ifdef::aws[]



=== AWSでのサポート

* データ階層化は、Cloud Volumes ONTAP 9.2 以降で AWS でサポートされます。
* パフォーマンス層は、汎用 SSD (gp3 または gp2) またはプロビジョニングされた IOPS SSD (io1) にすることができます。
+

NOTE: スループット最適化 HDD (st1) を使用する場合は、オブジェクト ストレージにデータを階層化することはお勧めしません。

* 非アクティブなデータは Amazon S3 バケットに階層化されます。他のプロバイダーへの階層化はサポートされていません。


endif::aws[]

ifdef::azure[]



=== Azureでのサポート

* Azure では、データ階層化は次のようにサポートされています。
+
** シングルノードシステムのバージョン9.4
** HAペア付きバージョン9.6


* パフォーマンス レベルは、Premium SSD マネージド ディスク、Standard SSD マネージド ディスク、または Standard HDD マネージド ディスクになります。
* 非アクティブなデータは Microsoft Azure Blob に階層化されます。他のプロバイダーへの階層化はサポートされていません。


endif::azure[]

ifdef::gcp[]



=== Google Cloud のサポート

* データ階層化は、Cloud Volumes ONTAP 9.6 以降、Google Cloud でサポートされます。
* パフォーマンス レベルは、SSD 永続ディスク、バランス永続ディスク、標準永続ディスクのいずれかになります。
* 非アクティブなデータは Google Cloud Storage に階層化されます。他のプロバイダーへの階層化はサポートされていません。


endif::gcp[]



=== 機能の相互運用性

* データ階層化は暗号化テクノロジーによってサポートされます。
* ボリューム上でシンプロビジョニングを有効にする必要があります。




== 要件

クラウド プロバイダーによっては、 Cloud Volumes ONTAP がコールド データをオブジェクト ストレージに階層化できるように、特定の接続とアクセス許可を設定する必要があります。

ifdef::aws[]



=== コールドデータをAWS S3に階層化するための要件

Cloud Volumes ONTAP がS3 に接続されていることを確認します。この接続を提供する最善の方法は、S3 サービスへの VPC エンドポイントを作成することです。手順については、 https://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/vpce-gateway.html#create-gateway-endpoint["AWS ドキュメント: ゲートウェイエンドポイントの作成"^] 。

VPC エンドポイントを作成するときは、 Cloud Volumes ONTAPインスタンスに対応するリージョン、VPC、ルートテーブルを選択してください。また、セキュリティ グループを変更して、S3 エンドポイントへのトラフィックを有効にする送信 HTTPS ルールを追加する必要があります。そうしないと、 Cloud Volumes ONTAP はS3 サービスに接続できません。

問題が発生した場合は、 https://aws.amazon.com/premiumsupport/knowledge-center/connect-s3-vpc-endpoint/["AWS サポート ナレッジセンター: ゲートウェイ VPC エンドポイントを使用して S3 バケットに接続できないのはなぜですか?"^] 。

endif::aws[]

ifdef::azure[]



=== コールドデータをAzure Blobストレージに階層化するための要件

コンソールに必要な権限がある限り、パフォーマンス層と容量層の間に接続を設定する必要はありません。コンソール エージェントのカスタム ロールに次の権限がある場合、コンソールは VNet サービス エンドポイントを有効にします。

[source, json]
----
"Microsoft.Network/virtualNetworks/subnets/write",
"Microsoft.Network/routeTables/join/action",
----
カスタム ロールには、デフォルトで権限が含まれます。 https://docs.netapp.com/us-en/bluexp-setup-admin/reference-permissions-azure.html["コンソール エージェントの Azure 権限を表示する"^]

endif::azure[]

ifdef::gcp[]



=== コールドデータを Google Cloud Storage バケットに階層化するための要件

* Cloud Volumes ONTAPが存在するサブネットは、プライベート Google アクセス用に構成する必要があります。手順については、 https://cloud.google.com/vpc/docs/configure-private-google-access["Google Cloud ドキュメント: プライベート Google アクセスの設定"^] 。
* サービス アカウントをCloud Volumes ONTAPに接続する必要があります。
+
link:task-creating-gcp-service-account.html["このサービスアカウントの設定方法を学ぶ"] 。

+
Cloud Volumes ONTAPシステムを作成するときに、このサービス アカウントを選択するように求められます。

+
デプロイ中にサービス アカウントを選択しない場合は、 Cloud Volumes ONTAPをシャットダウンし、Google Cloud コンソールに移動して、サービス アカウントをCloud Volumes ONTAPインスタンスに接続する必要があります。次のセクションで説明するように、データ階層化を有効にできます。

* 顧客管理の暗号鍵を使用してバケットを暗号化するには、Google Cloud ストレージ バケットで鍵の使用を有効にします。
+
link:task-setting-up-gcp-encryption.html["Cloud Volumes ONTAPで顧客管理の暗号化キーを使用する方法を学びます"] 。



endif::gcp[]



=== 要件を実装した後、データ階層化を有効にする

接続性や権限の問題がない限り、コンソールはシステムの作成時にコールド データ用のオブジェクト ストアを作成します。システムの作成後まで上記の要件を実装しなかった場合は、オブジェクト ストアを作成する API またはONTAP System Manager を使用して階層化を手動で有効にする必要があります。


NOTE: コンソールを通じて階層化を有効にする機能は、将来のCloud Volumes ONTAPリリースで利用できるようになります。



== アグリゲートで階層化が有効になっていることを確認する

ボリューム上でデータ階層化を有効にするには、アグリゲート上でデータ階層化を有効にする必要があります。新しいボリュームと既存のボリュームの要件を認識しておく必要があります。

* *新刊*
+
新しいボリュームでデータ階層化を有効にする場合は、アグリゲートでデータ階層化を有効にすることについて心配する必要はありません。コンソールは、階層化が有効になっている既存のアグリゲート上にボリュームを作成するか、データ階層化が有効になっているアグリゲートがまだ存在しない場合は、ボリュームの新しいアグリゲートを作成します。

* *既存の巻*
+
既存のボリュームでデータ階層化を有効にするには、基礎となるアグリゲートでそれが有効になっていることを確認します。既存のアグリゲートでデータ階層化が有効になっていない場合は、 ONTAP System Manager を使用して既存のアグリゲートをオブジェクト ストアに接続する必要があります。



.アグリゲートで階層化が有効になっているかどうかを確認する手順
. 左側のナビゲーション メニューから、*ストレージ > 管理* を選択します。
. Cloud Volumes ONTAPシステムを開きます。
. *Aggregates* タブを選択し、アグリゲートで階層化が有効になっているか無効になっているかを確認します。
+
image:screenshot_aggregate_tiering_enabled.png["階層化ステータスを含む、コンソール内のアグリゲートに関する情報を表示するスクリーンショット。"]



.アグリゲート上で階層化を有効にする手順
. ONTAP System Manager で、*ストレージ > 階層* をクリックします。
. アグリゲートのアクション メニューをクリックし、*クラウド ティアの接続*を選択します。
. アタッチするクラウド層を選択し、「*保存*」をクリックします。


.次の手順
次のセクションで説明するように、新規および既存のボリュームでデータ階層化を有効にできるようになりました。



== 読み書きボリュームからの階層データ

Cloud Volumes ONTAP は、読み取り/書き込みボリューム上の非アクティブなデータをコスト効率の高いオブジェクト ストレージに階層化し、パフォーマンス層をホット データ用に解放します。

.手順
. システムの「ボリューム」タブで、新しいボリュームを作成するか、既存のボリュームの階層を変更します。
+
[cols="30,70"]
|===
| Task | アクション 


| 新しいボリュームを作成 | *新しいボリュームの追加*をクリックします。 


| 既存のボリュームの変更 | 目的のボリューム タイルを選択し、*ボリュームの管理* をクリックしてボリュームの管理の右側のパネルにアクセスし、右側のパネルの下にある *詳細アクション* と *階層化ポリシーの変更* をクリックします。 
|===
. 階層化ポリシーを選択します。
+
これらのポリシーの説明については、link:concept-data-tiering.html["データ階層化の概要"] 。

+
*例*

+
image:screenshot_volumes_change_tiering_policy.png["ボリュームの階層化ポリシーを変更するために使用できるオプションを示すスクリーンショット。"]

+
データ階層化対応のアグリゲートがまだ存在しない場合、コンソールはボリュームの新しいアグリゲートを作成します。





== データ保護ボリュームからの階層データ

Cloud Volumes ONTAP は、データ保護ボリュームから容量層にデータを階層化できます。宛先ボリュームをアクティブ化すると、データは読み取られるにつれて徐々にパフォーマンス層に移動します。

.手順
. 左側のナビゲーション メニューから、*ストレージ > 管理* を選択します。
. *システム*ページで、ソースボリュームを含むCloud Volumes ONTAPシステムを選択し、ボリュームを複製するシステムにドラッグします。
. 階層化ページに到達するまでプロンプトに従い、オブジェクト ストレージへのデータ階層化を有効にします。
+
*例*

+
image:screenshot_replication_tiering.gif["ボリュームを複製する際の S3 階層化オプションを示すスクリーンショット。"]

+
データの複製に関するヘルプについては、以下を参照してください。 https://docs.netapp.com/us-en/bluexp-replication/task-replicating-data.html["クラウドとの間でデータを複製する"^] 。





== 階層化データのストレージクラスを変更する

Cloud Volumes ONTAPを導入した後、30 日間アクセスされていない非アクティブなデータのストレージ クラスを変更することで、ストレージ コストを削減できます。データにアクセスする場合、アクセス コストが高くなるため、ストレージ クラスを変更する前にその点を考慮する必要があります。

階層化データのストレージ クラスはシステム全体にわたっており、ボリュームごとではありません。

サポートされているストレージクラスの詳細については、link:concept-data-tiering.html["データ階層化の概要"] 。

.手順
. Cloud Volumes ONTAPシステムで、メニュー アイコンをクリックし、*ストレージ クラス* または *Blob ストレージ階層化* をクリックします。
. ストレージ クラスを選択し、[*保存*] をクリックします。




== データ階層化の空き領域比率を変更する

データ階層化の空き領域比率は、データをオブジェクト ストレージに階層化するときに、Cloud Volumes ONTAP SSD/HDD に必要な空き領域の量を定義します。デフォルト設定は 10% の空き領域ですが、要件に応じて設定を微調整できます。

たとえば、購入した容量を確実に活用するには、空き領域を 10% 未満に選択する場合があります。追加の容量が必要になったときに、コンソールは追加のディスクを購入できます (アグリゲートのディスク制限に達するまで)。


CAUTION: 十分なスペースがない場合、 Cloud Volumes ONTAP はデータを移動できず、パフォーマンスが低下する可能性があります。いかなる変更も慎重に行う必要があります。不明な場合は、 NetAppサポートに問い合わせてガイダンスを受けてください。

この比率は、オブジェクト ストアからデータが読み取られると、 Cloud Volumes ONTAP がデータを SSD/HDD に移動してパフォーマンスを向上させるため、災害復旧シナリオにとって重要です。十分なスペースがない場合、 Cloud Volumes ONTAP はデータを移動できません。ビジネス要件を満たすことができるように比率を変更するときは、この点を考慮してください。

.手順
. 左側のナビゲーション ペインから、*管理 > エージェント* に移動します。
. クリックimage:icon-action.png[""]Cloud Volumes ONTAPシステムを管理するコンソール エージェントのアイコン。
. * Cloud Volumes ONTAP設定*を選択します。
+
image::screenshot-settings-cloud-volumes-ontap.png[[設定]アイコンの下のCloud Volumes ONTAP設定オプションのスクリーンショット。]

. *容量*の下で、*総容量しきい値 - データ階層化の空き領域比率*をクリックします。
+
image:screenshot-cvo-settings-page.png["Cloud Volumes ONTAPの容量設定の概要。"]

. 要件に応じて空き領域の比率を変更し、「*保存*」をクリックします。




== 自動階層化ポリシーの冷却期間を変更する

_auto_ 階層化ポリシーを使用してCloud Volumes ONTAPボリュームでデータ階層化を有効にした場合は、ビジネス ニーズに基づいてデフォルトの冷却期間を調整できます。このアクションは、 ONTAP CLI および API のみを使用してサポートされます。

冷却期間とは、ボリューム内のユーザー データが「コールド」であるとみなされてオブジェクト ストレージに移動されるまでに非アクティブのままでいなければならない日数です。

自動階層化ポリシーのデフォルトの冷却期間は 31 日です。冷却期間は次のように変更できます。

* 9.8以降: 2日から183日
* 9.7以前: 2日から63日


.手順
. ボリュームを作成するとき、または既存のボリュームを変更するときは、API リクエストで _minimumCoolingDays_ パラメータを使用します。




== システムの廃止時にS3バケットを削除する

環境を廃止するときに、 Cloud Volumes ONTAPシステムから階層化されたデータを含む S3 バケットを削除できます。

S3 バケットを削除できるのは、次の場合のみです。

* Cloud Volume ONTAPシステムがコンソールから削除されます。
* すべてのオブジェクトがバケットから削除され、S3 バケットは空になります。


Cloud Volumes ONTAPシステムを廃止しても、その環境用に作成された S3 バケットは自動的に削除されません。代わりに、偶発的なデータ損失を防ぐために孤立状態のままになります。バケット内のオブジェクトを削除してから、S3 バケット自体を削除するか、後で使用するために保持することができます。参照 https://docs.netapp.com/us-en/ontap-cli/vserver-object-store-server-bucket-delete.html#description["ONTAP CLI: vserver object-store-server バケット削除"^]。
