---
sidebar: sidebar 
permalink: concept-ha.html 
keywords: high availability, HA, mediator, concepts, understanding, overview, availability zones, AZs, takeover, giveback, rpo, rto, floating ip, nondisruptive, ha pairs, node, nodes, synchronous, resync, recovery point objective, recovery time objective, nas, nfs, cifs, floating ip address, route tables, iscsi, mpio, alua, failover, mount, remount, failure, data access, access, ip address, performance 
summary: 'Cloud Volumes ONTAP の高可用性 (HA) 構成は、中断のない運用とフォールト トレランスを実現します。  AWS では、データは 2 つのノード間で同期的にミラーリングされます。' 
---
= AWS のCloud Volumes ONTAP HA ペアについて学ぶ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Cloud Volumes ONTAP の高可用性 (HA) 構成は、中断のない運用とフォールト トレランスを実現します。  AWS では、データは 2 つのノード間で同期的にミラーリングされます。



== HA コンポーネント

AWS では、 Cloud Volumes ONTAP HA 構成には次のコンポーネントが含まれます。

* データが相互に同期してミラーリングされる 2 つのCloud Volumes ONTAPノード。
* ストレージの引き継ぎとギブバックのプロセスを支援するためにノード間の通信チャネルを提供するメディエーター インスタンス。




=== メディエーター

AWS のメディエーターインスタンスに関する重要な詳細は次のとおりです。

インスタンスタイプ:: t3-マイクロ
ディスク:: 8 GiB と 4 GiB の 2 つの st1 ディスク
オペレーティング システム:: Debian 11
+
--

NOTE: Cloud Volumes ONTAP 9.10.0 以前では、Debian 10 がメディエーターにインストールされていました。

--
アップグレード:: Cloud Volumes ONTAPをアップグレードすると、 NetApp Consoleは必要に応じてメディエーター インスタンスも更新します。
インスタンスへのアクセス:: コンソールからCloud Volumes ONTAP HA ペアを作成すると、メディエーター インスタンスのキー ペアを指定するように求められます。このキーペアはSSHアクセスに使用できます。 `admin`ユーザー。
サードパーティエージェント:: サードパーティ エージェントまたは VM 拡張機能は、メディエーター インスタンスではサポートされません。




== ストレージの引き継ぎと返却

1 つのノードがダウンした場合、他のノードがパートナーにデータを提供して、継続的なデータ サービスを提供します。データはパートナーに同期的にミラーリングされているため、クライアントはパートナー ノードから同じデータにアクセスできます。

ノードが再起動した後、パートナーはストレージを返す前にデータを再同期する必要があります。データの再同期にかかる時間は、ノードがダウンしている間に変更されたデータの量によって異なります。

ストレージのテイクオーバー、再同期、ギブバックはすべてデフォルトで自動で行われます。ユーザーの操作は必要ありません。



== RPOおよびRTO

HA 構成では、次のようにデータの高可用性が維持されます。

* Recovery Point Objective（RPO;目標復旧時点）は0秒です。データはトランザクションの整合性が確保されており、データ損失はありません。
* Recovery Time Objective（RTO;目標復旧時間）は120秒です。障害が発生した場合、データは120秒以内に使用可能になります。




== HA展開モデル

複数のアベイラビリティーゾーン (AZ) 全体または単一のアベイラビリティーゾーン (AZ) に HA 構成を展開することで、データの高可用性を確保できます。それぞれの構成の詳細を確認して、ニーズに最適なものを選択してください。



=== 複数のアベイラビリティゾーン

複数のアベイラビリティゾーン (AZ) に HA 構成を展開すると、AZ またはCloud Volumes ONTAPノードを実行するインスタンスで障害が発生した場合でも、データの高可用性が保証されます。  NAS IP アドレスがデータ アクセスとストレージ フェイルオーバーにどのような影響を与えるかを理解する必要があります。



==== NFSおよびCIFSデータアクセス

HA 構成が複数のアベイラビリティーゾーンに分散されている場合、_フローティング IP アドレス_ によって NAS クライアント アクセスが可能になります。フローティング IP アドレスは、リージョン内のすべての VPC の CIDR ブロックの外側にある必要があり、障害が発生するとノード間で移行できます。  VPC外のクライアントからはネイティブにアクセスできません。link:task-setting-up-transit-gateway.html["AWSトランジットゲートウェイを設定する"] 。

トランジットゲートウェイを設定できない場合は、VPC 外の NAS クライアントでプライベート IP アドレスを使用できます。ただし、これらの IP アドレスは静的であり、ノード間でフェイルオーバーすることはできません。

複数のアベイラビリティーゾーンにわたって HA 構成を展開する前に、フローティング IP アドレスとルート テーブルの要件を確認する必要があります。構成を展開するときに、フローティング IP アドレスを指定する必要があります。プライベート IP アドレスは自動的に作成されます。

詳細については、 link:https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/reference-networking-aws.html#requirements-for-ha-pairs-in-multiple-azs["複数の AZ におけるCloud Volumes ONTAP HA の AWS ネットワーク要件"^] 。



==== iSCSIデータアクセス

iSCSI はフローティング IP アドレスを使用しないため、VPC 間のデータ通信は問題になりません。



==== iSCSI のテイクオーバーとギブバック

iSCSI の場合、 Cloud Volumes ONTAP はマルチパス I/O (MPIO) と非対称論理ユニット アクセス (ALUA) を使用して、アクティブに最適化されたパスと最適化されていないパス間のパス フェイルオーバーを管理します。


NOTE: ALUAをサポートする特定のホスト構成については、 http://mysupport.netapp.com/matrix["NetApp Interoperability Matrix Tool"^]そして https://docs.netapp.com/us-en/ontap-sanhost/["SANホストとクラウドクライアントガイド"]ホスト オペレーティング システム用。



==== NASの買収と返還

フローティング IP を使用する NAS 構成でテイクオーバーが発生すると、クライアントがデータにアクセスするために使用するノードのフローティング IP アドレスが他のノードに移動します。次の図は、フローティング IP を使用した NAS 構成でのストレージのテイクオーバーを示しています。ノード 2 がダウンした場合、ノード 2 のフローティング IP アドレスはノード 1 に移動します。

image:diagram_takeover_giveback.png["Cloud Volumes ONTAP HA ペアでのストレージ テイクオーバーを示す概念図: ノード 1 のフローティング IP アドレスがノード 2 に移動します。"]

障害が発生した場合、外部 VPC アクセスに使用される NAS データ IP はノード間で移行できません。ノードがオフラインになった場合は、他のノードの IP アドレスを使用して、VPC 外部のクライアントにボリュームを手動で再マウントする必要があります。

障害が発生したノードがオンラインに戻ったら、元の IP アドレスを使用してクライアントをボリュームに再マウントします。この手順は、パフォーマンスと安定性に重大な影響を与える可能性のある、2 つの HA ノード間での不要なデータの転送を回避するために必要です。

ボリュームを選択し、*マウント コマンド*をクリックすると、コンソールから正しい IP アドレスを見つけることができます。



=== 単一のアベイラビリティゾーン

単一のアベイラビリティゾーン (AZ) に HA 構成を展開すると、 Cloud Volumes ONTAPノードを実行するインスタンスに障害が発生した場合でも、データの高可用性を確保できます。すべてのデータは VPC の外部からネイティブにアクセスできます。


NOTE: コンソールは https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html["AWS ドキュメント: AWS スプレッド配置グループ"^]そして、その配置グループ内の 2 つの HA ノードを起動します。配置グループは、インスタンスを異なる基盤ハードウェアに分散させることで、同時障害のリスクを軽減します。この機能は、ディスク障害の観点ではなく、コンピューティングの観点から冗長性を向上させます。



==== データ アクセス

この構成は単一の AZ 内にあるため、フローティング IP アドレスは必要ありません。  VPC 内からのデータアクセスと VPC 外からのデータアクセスに同じ IP アドレスを使用できます。

次の図は、単一の AZ での HA 構成を示しています。データは VPC 内からも VPC 外からもアクセスできます。

image:diagram_single_az.png["VPC 外部からのデータ アクセスを許可する単一のアベイラビリティー ゾーン内のONTAP HA 構成を示す概念図。"]



==== 買収と返還

iSCSI の場合、 Cloud Volumes ONTAP はマルチパス I/O (MPIO) と非対称論理ユニット アクセス (ALUA) を使用して、アクティブに最適化されたパスと最適化されていないパス間のパス フェイルオーバーを管理します。


NOTE: ALUAをサポートする特定のホスト構成については、 http://mysupport.netapp.com/matrix["NetApp Interoperability Matrix Tool"^]そして https://docs.netapp.com/us-en/ontap-sanhost/["SANホストとクラウドクライアントガイド"]ホスト オペレーティング システム用。

NAS 構成の場合、障害が発生した場合、データ IP アドレスは HA ノード間で移行できます。これにより、クライアントのストレージへのアクセスが保証されます。



=== AWS ローカルゾーン

AWS ローカルゾーンは、ストレージ、コンピューティング、データベース、およびその他の厳選された AWS サービスが大都市や産業地域の近くに配置されているインフラストラクチャ展開です。  AWS Local Zones を使用すると、AWS のサービスをお客様の近くに配置できるため、ワークロードのレイテンシーが改善され、データベースがローカルで維持されます。  Cloud Volumes ONTAPでは、

AWS ローカルゾーンに単一の AZ または複数の AZ 構成をデプロイできます。


NOTE: コンソールを標準モードおよびプライベートモードで使用する場合、AWS ローカルゾーンがサポートされます。現時点では、AWS ローカルゾーンは制限モードではサポートされていません。



==== AWS ローカルゾーンの設定例

AWS のCloud Volumes ONTAPは、単一のアベイラビリティーゾーンで高可用性 (HA) モードのみをサポートします。単一ノードの展開はサポートされていません。

Cloud Volumes ONTAP は、 AWS ローカルゾーンのデータ階層化、クラウド階層化、および非適格インスタンスをサポートしていません。

以下に構成例を示します。

* 単一の可用性ゾーン: クラスター ノードとメディエーターは両方とも同じローカル ゾーンにあります。
* 複数の可用性ゾーン 複数の可用性ゾーン構成では、3 つのインスタンス、2 つのノード、および 1 つのメディエーターが存在します。 3 つのインスタンスのうち 1 つは別のゾーンに配置する必要があります。設定方法を選択できます。
+
以下に 3 つの構成例を示します。

+
** 各クラスター ノードは異なるローカル ゾーンにあり、メディエーターはパブリック アベイラビリティ ゾーンにあります。
** 1 つのクラスター ノードはローカル ゾーンにあり、メディエーターはローカル ゾーンにあり、2 番目のクラスター ノードはアベイラビリティー ゾーンにあります。
** 各クラスター ノードとメディエーターは別々のローカル ゾーンにあります。






==== サポートされているディスクとインスタンスタイプ

サポートされているディスク タイプは GP2 のみです。現在、xlarge から 4xlarge までのサイズの次の EC2 インスタンス タイプ ファミリがサポートされています。

* M5
* C5
* C5d
* R5
* R5d



NOTE: Cloud Volumes ONTAP はこれらの構成のみをサポートします。 AWS ローカルゾーン構成でサポートされていないディスクタイプまたは不適格なインスタンスを選択すると、デプロイメントが失敗する可能性があります。接続性がないため、AWS ローカルゾーンでは AWS S3 へのデータ階層化は利用できません。

link:https://aws.amazon.com/about-aws/global-infrastructure/localzones/features/?nc=sn&loc=2["AWS ドキュメント: ローカルゾーンの EC2 インスタンスタイプ"^] 。



== HAペアにおけるストレージの仕組み

ONTAPクラスターとは異なり、 Cloud Volumes ONTAP HA ペアのストレージはノード間で共有されません。代わりに、障害発生時にデータが利用できるように、データはノード間で同期的にミラーリングされます。



=== ストレージ割り当て

新しいボリュームを作成し、追加のディスクが必要になった場合、コンソールは両方のノードに同じ数のディスクを割り当て、ミラー化されたアグリゲートを作成してから、新しいボリュームを作成します。たとえば、ボリュームに 2 つのディスクが必要な場合、コンソールはノードごとに 2 つのディスクを割り当て、合計 4 つのディスクを割り当てます。



=== ストレージ構成

HA ペアは、両方のノードがクライアントにデータを提供するアクティブ/アクティブ構成として使用することも、アクティブ ノードのストレージを引き継いだ場合にのみパッシブ ノードがデータ要求に応答するアクティブ/パッシブ構成として使用することもできます。


NOTE: アクティブ/アクティブ構成を設定できるのは、ストレージ システム ビューのコンソールを使用する場合のみです。



=== パフォーマンスの期待

Cloud Volumes ONTAP HA 構成では、ノード間でデータが同期的に複製されるため、ネットワーク帯域幅が消費されます。その結果、単一ノードのCloud Volumes ONTAP構成と比較して、次のパフォーマンスが期待できます。

* 1 つのノードからのみデータを提供する HA 構成の場合、読み取りパフォーマンスは単一ノード構成の読み取りパフォーマンスに匹敵しますが、書き込みパフォーマンスは低くなります。
* 両方のノードからデータを提供する HA 構成の場合、読み取りパフォーマンスは単一ノード構成の読み取りパフォーマンスよりも高く、書き込みパフォーマンスは同じかそれ以上になります。


Cloud Volumes ONTAPのパフォーマンスの詳細については、以下を参照してください。link:concept-performance.html["パフォーマンス"] 。



=== ストレージへのクライアントアクセス

クライアントは、ボリュームが存在するノードのデータ IP アドレスを使用して NFS および CIFS ボリュームにアクセスする必要があります。  NAS クライアントがパートナー ノードの IP アドレスを使用してボリュームにアクセスすると、トラフィックが両方のノード間で行われ、パフォーマンスが低下します。


TIP: HA ペアのノード間でボリュームを移動する場合は、他のノードの IP アドレスを使用してボリュームを再マウントする必要があります。そうしないと、パフォーマンスが低下する可能性があります。クライアントが NFSv4 参照または CIFS のフォルダー リダイレクトをサポートしている場合は、 Cloud Volumes ONTAPシステムでこれらの機能を有効にして、ボリュームの再マウントを回避できます。詳細については、 ONTAP のドキュメントを参照してください。

ボリューム管理パネルの下にある _マウント コマンド_ オプションを使用して、正しい IP アドレスを簡単に識別できます。

image::screenshot_mount_option.png[400]
