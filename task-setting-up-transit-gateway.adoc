---
sidebar: sidebar 
permalink: task-setting-up-transit-gateway.html 
keywords: transit gateway, aws, amazon web services, transit gateway, floating ip, client access, nas, outside, vpc, virtual private cloud, route table 
summary: AWS トランジットゲートウェイを設定して、 Cloud Volumes ONTAPが存在する VPC の外部から NAS クライアントがフローティング IP アドレスにアクセスできるようにします。これは、障害が発生するとフローティング IP がノード間で自動的に移行されるため、有益です。 
---
= Cloud Volumes ONTAP HAペア用のAWSトランジットゲートウェイを設定する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
AWSトランジットゲートウェイを設定してHAペアのアクセスを有効にするlink:reference-networking-aws.html#requirements-for-ha-pairs-in-multiple-azs["フローティングIPアドレス"]HA ペアが存在する VPC の外部から。

Cloud Volumes ONTAP HA 構成が複数の AWS アベイラビリティーゾーンに分散されている場合、VPC 内からの NAS データ アクセスにはフローティング IP アドレスが必要です。これらのフローティング IP アドレスは、障害が発生したときにノード間で移行できますが、VPC の外部からはネイティブにアクセスできません。個別のプライベート IP アドレスは VPC 外部からのデータ アクセスを提供しますが、自動フェイルオーバーは提供しません。

クラスタ管理インターフェイスとオプションの SVM 管理 LIF にもフローティング IP アドレスが必要です。

AWS トランジットゲートウェイを設定すると、HA ペアが存在する VPC の外部からフローティング IP アドレスへのアクセスが可能になります。つまり、VPC 外部の NAS クライアントとNetApp管理ツールはフローティング IP にアクセスできます。

以下は、トランジットゲートウェイによって接続された 2 つの VPC を示す例です。 HA システムは 1 つの VPC に存在し、クライアントは別の VPC に存在します。その後、フローティング IP アドレスを使用してクライアントに NAS ボリュームをマウントできます。

image:diagram_transit_gateway.png["1 つの VPC 内の HA 構成 (フローティング IP が ENI にルーティングされます)、別の VPC 内のクライアント (フローティング IP がトランジット ゲートウェイにルーティングされます)、およびトランジット ゲートウェイ (フローティング IP が VPC1 ルート テーブルにルーティングされます) を示す図。"]

次の手順では、同様の構成を設定する方法を示します。

.手順
. https://docs.aws.amazon.com/vpc/latest/tgw/tgw-getting-started.html["トランジットゲートウェイを作成し、VPC をゲートウェイに接続する"^] 。
. VPC をトランジット ゲートウェイ ルート テーブルに関連付けます。
+
.. *VPC* サービスで、*Transit Gateway ルート テーブル* をクリックします。
.. ルート テーブルを選択します。
.. *関連付け*をクリックし、*関連付けの作成*を選択します。
.. 関連付ける添付ファイル (VPC) を選択し、[関連付けの作成] をクリックします。


. HA ペアのフローティング IP アドレスを指定して、トランジット ゲートウェイのルート テーブルにルートを作成します。
+
フローティング IP アドレスは、 NetApp Consoleのシステム情報ページで確認できます。次に例を示します。

+
image:screenshot_floating_ips.gif["クラスター管理インターフェイス、2 つの NFS および CIFS データ インターフェイス、および SVM 管理インターフェイスのフローティング IP アドレスを示すスクリーンショット。"]

+
次のサンプル画像は、トランジット ゲートウェイのルート テーブルを示しています。これには、Cloud Volumes ONTAPで使用される 2 つの VPC の CIDR ブロックと 4 つのフローティング IP アドレスへのルートが含まれます。

+
image:screenshot_transit_gateway1.png["トランジットゲートウェイのルートテーブルを表示する AWS コンソールのスクリーンショット。これには、Cloud Volumes ONTAPで使用される 2 つの VPC の CIDR ブロックと 4 つのフローティング IP アドレスへのルートが含まれます。"]

. フローティング IP アドレスにアクセスする必要がある VPC のルート テーブルを変更します。
+
.. フローティング IP アドレスにルート エントリを追加します。
.. HA ペアが存在する VPC の CIDR ブロックにルートエントリを追加します。
+
次のサンプル画像は、VPC 1 へのルートとフローティング IP アドレスを含む VPC 2 のルートテーブルを示しています。

+
image:screenshot_transit_gateway2.png["VPC 1 へのルートとフローティング IP アドレスを含む VPC 2 のルートテーブルを表示する AWS コンソールのスクリーンショット。"]



. フローティング IP アドレスへのアクセスが必要な VPC にルートを追加して、HA ペアの VPC のルート テーブルを変更します。
+
このステップは、VPC 間のルーティングを完了するため重要です。

+
次のサンプル画像は、VPC 1 のルート テーブルを示しています。これには、フローティング IP アドレスと、クライアントが存在する VPC 2 へのルートが含まれます。コンソールは、HA ペアを展開するときに、フローティング IP をルート テーブルに自動的に追加しました。

+
image:screenshot_transit_gateway3.png["VPC 1 のルートテーブルを表示する AWS コンソールのスクリーンショット。これには、フローティング IP アドレスと、クライアントが存在する VPC 2 へのルートが含まれます。"]

. VPC のセキュリティ グループ設定をすべてのトラフィックに更新します。
+
.. 仮想プライベートクラウドの下で、*サブネット*をクリックします。
.. *ルート テーブル* タブをクリックし、HA ペアのフローティング IP アドレスの 1 つに対して目的の環境を選択します。
.. *セキュリティ グループ*をクリックします。
.. *受信規則の編集*を選択します。
.. *ルールを追加*をクリックします。
.. [タイプ] で [すべてのトラフィック] を選択し、VPC IP アドレスを選択します。
.. 変更を適用するには、[*ルールを保存*] をクリックします。


. フローティング IP アドレスを使用してボリュームをクライアントにマウントします。
+
コンソールの「ボリュームの管理」パネルの下にある *マウント コマンド* オプションを通じて、コンソールで正しい IP アドレスを見つけることができます。

+
image::screenshot_mount_option.png[400]

. NFS ボリュームをマウントする場合は、クライアント VPC のサブネットと一致するようにエクスポート ポリシーを設定します。
+
link:task-manage-volumes.html["ボリュームの編集方法を学ぶ"] 。



*関連リンク*

* link:concept-ha.html["AWSのハイアベイラビリティ ペア"]
* link:reference-networking-aws.html["AWS におけるCloud Volumes ONTAPのネットワーク要件"]

